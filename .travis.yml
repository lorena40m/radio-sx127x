language: rust
cache: cargo

matrix:
  include:
  - env: TARGET=x86_64-unknown-linux-gnu
    os: linux
  - env: TARGET=armv7-unknown-linux-gnueabihf
    os: linux
    addons:
      apt:
        packages:
          - libc6-i386
          - libc6-dev-i386
          - gcc-arm-linux-gnueabihf
          - libc6-armhf-cross
          - libc6-dev-armhf-cross

install:
- cargo fetch
- rustup target add armv7-unknown-linux-gnueabihf
- rustup component add rustfmt

script: 
  - cargo build && cargo test && cargo build --target=$TARGET --release

before_deploy: 
  - "tar -cvf target/sx128-$TARGET-$TRAVIS_TAG.tgz -C target/$TARGET/release/ sx127x-util || return 0" 

notifications:
  email:
    on_success: never
    on_failure: never
